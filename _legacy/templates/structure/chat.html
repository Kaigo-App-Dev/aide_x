<!-- ãƒãƒ£ãƒƒãƒˆå°‚ç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ -->
<div class="chat-messages" id="chatMessages">
  {% set conversation_count = 0 %}
  {% set notification_count = 0 %}
  
  <!-- ä¼šè©±ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®ã‚„ã‚Šå–ã‚Šï¼‰ -->
  {% for msg in msg_list_safe %}
    {% if msg.type in ["user", "assistant_reply", "chat"] %}
      {% set conversation_count = conversation_count + 1 %}
      <div class="message {{ msg.role }} {{ msg.type }}"
           data-source="{{ msg.source }}"
           data-type="{{ msg.type }}"
           {% if msg.type == 'assistant_reply' %}data-testid="assistant-reply"{% endif %}
           {% if msg.role == 'user' %}data-testid="user-message"{% endif %}>
        <div class="message-header">
          {% if msg.type == "assistant_reply" %}ğŸ¤– ChatGPT{% endif %}
          {% if msg.role == "user" %}ğŸ‘¤ ã‚ãªãŸ{% endif %}
        </div>
        <div class="message-content">{{ (msg.content if msg.content is defined else msg.text) | safe }}</div>
        {% if msg.timestamp %}
        <div class="message-time">{{ msg.timestamp }}</div>
        {% endif %}
      </div>
    {% endif %}
  {% endfor %}
  
  <!-- é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆç¢ºèªã€ä¿®æ­£ä¾é ¼ã€æ‰¿èªãªã©ï¼‰ -->
  {% for msg in msg_list_safe %}
    {% if msg.type in ["note", "confirmation", "revision_request", "confirmation_accepted", "notification", "evaluation", "completion"] %}
      {% set notification_count = notification_count + 1 %}
      <div class="message notification {{ msg.type }}"
           data-source="{{ msg.source }}"
           data-type="{{ msg.type }}"
           {% if msg.type == 'confirmation' %}data-testid="confirmation-message"{% endif %}>
        <div class="message-header">
          {% if msg.type == "confirmation" %}âš ï¸ ç¢ºèª{% endif %}
          {% if msg.type == "revision_request" %}ğŸ’¡ ä¿®æ­£ä¾é ¼{% endif %}
          {% if msg.type == "confirmation_accepted" %}âœ… æ‰¿èª{% endif %}
          {% if msg.type == "note" %}ğŸ“ ãƒ¡ãƒ¢{% endif %}
          {% if msg.type == "notification" %}ğŸ”” é€šçŸ¥{% endif %}
          {% if msg.type == "evaluation" %}ğŸ” è©•ä¾¡{% endif %}
          {% if msg.type == "completion" %}âœ¨ è£œå®Œ{% endif %}
        </div>
        <div class="message-content">{{ (msg.content if msg.content is defined else msg.text) | safe }}</div>
        {% if msg.timestamp %}
        <div class="message-time">{{ msg.timestamp }}</div>
        {% endif %}
      </div>
    {% endif %}
  {% endfor %}
  
  <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒãªã„å ´åˆã®è¡¨ç¤º -->
  {% if conversation_count == 0 and notification_count == 0 %}
    <div id="no-message-placeholder" class="chat-placeholder">
      <div class="placeholder-icon">ğŸ’¬</div>
      <div class="placeholder-text">
        <h4>ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ</h4>
        <p>ã“ã“ã«ä¼šè©±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
        <p class="text-muted">æ§‹æˆã«ã¤ã„ã¦è³ªå•ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼</p>
        <div class="placeholder-actions">
          <button class="btn btn-sm btn-primary" onclick="suggestChatMessage()">
            ğŸ’¡ è³ªå•ã‚’ææ¡ˆ
          </button>
        </div>
      </div>
    </div>
  {% elif conversation_count == 0 %}
    <div id="no-message-placeholder" class="chat-placeholder">
      <div class="placeholder-icon">ğŸ’¬</div>
      <div class="placeholder-text">
        <h4>ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ</h4>
        <p>ä¼šè©±ãŒã‚ã‚Šã¾ã›ã‚“</p>
        <p class="text-muted">æ§‹æˆã«ã¤ã„ã¦è³ªå•ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼</p>
        <div class="placeholder-actions">
          <button class="btn btn-sm btn-primary" onclick="suggestChatMessage()">
            ğŸ’¡ è³ªå•ã‚’ææ¡ˆ
          </button>
        </div>
      </div>
    </div>
  {% endif %}
</div>

<!-- ãƒãƒ£ãƒƒãƒˆå…¥åŠ›ã‚¨ãƒªã‚¢ -->
<div class="chat-input-container">
    <div class="chat-input">
        <input type="text" id="chat-input" placeholder="æ§‹æˆã«ã¤ã„ã¦è³ªå•ã—ã¦ãã ã•ã„...">
        <button type="button" id="send-button">é€ä¿¡</button>
    </div>
</div>

<!-- AIæ“ä½œãƒœã‚¿ãƒ³ -->
<div class="ai-action-bar">
    <button id="saveStructureBtn" class="btn btn-primary">
        ğŸ’¾ æ§‹æˆä¿å­˜
    </button>
    <button id="completeGeminiBtn" class="btn btn-complete">
        âœ¨ Geminiè£œå®Œ
    </button>
    <button id="generateUIBtn" class="btn btn-ui">
        ğŸ¨ UIç”Ÿæˆ
    </button>
</div>

<!-- æ“ä½œãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
<div id="operationFeedback"></div> 