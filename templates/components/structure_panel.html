<!-- æ§‹é€ ãƒ‘ãƒãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ -->
<div class="center-content">
    <!-- æ§‹æˆã‚¿ã‚¤ãƒˆãƒ«è¡¨ç¤ºï¼ˆç”»é¢ä¸Šéƒ¨ï¼‰ -->
    <div id="structure-title" class="structure-title-section">
        <h2 class="structure-title">
            {{ structure.title if structure and structure.title else "ç„¡é¡Œã®æ§‹æˆ" }}
        </h2>
    </div>

    <!-- æ§‹æˆã‚«ãƒ¼ãƒ‰ï¼ˆå¸¸æ™‚è¡¨ç¤ºã€å„ªå…ˆé ˜åŸŸï¼‰ -->
    <div class="structure-cards-section">
        <div class="section-header">
            <h3>ğŸ“‹ æ§‹æˆã‚«ãƒ¼ãƒ‰</h3>
            <div class="section-actions">
                <span class="auto-update-status" style="display: none;">æ›´æ–°ä¸­...</span>
            </div>
        </div>
        <div class="structure-cards" id="structureCards">
            {% set structure_card_count = 0 %}
            {% for msg in msg_list_safe %}
                {% if msg.type == "structure_proposal" %}
                    {% set structure_card_count = structure_card_count + 1 %}
                    <div class="structure-card" data-type="{{ msg.type }}" data-testid="structure-card">
                        <div class="structure-label">
                            ğŸ” Claudeæ§‹æˆè©•ä¾¡
                        </div>
                        <div class="structure-content">{{ msg.content|safe }}</div>
                    </div>
                {% endif %}
            {% endfor %}
            {% if structure_card_count == 0 %}
                <div class="empty-structure-cards" id="structure-placeholder">
                    <div class="empty-message">
                        <h4>ğŸ“‹ æ§‹æˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</h4>
                        <p>ChatGPTã«æ§‹æˆã«ã¤ã„ã¦è³ªå•ã™ã‚‹ã¨ã€ã“ã“ã«æ§‹æˆã‚«ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                        <div class="suggestion-examples">
                            <p><strong>è³ªå•ä¾‹:</strong></p>
                            <ul>
                                <li>ã€ŒWebã‚¢ãƒ—ãƒªã®æ§‹æˆã‚’JSONå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€</li>
                                <li>ã€Œãƒ–ãƒ­ã‚°ã‚µã‚¤ãƒˆã®æ§‹æˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€</li>
                                <li>ã€ŒECã‚µã‚¤ãƒˆã®æ©Ÿèƒ½æ§‹æˆã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€</li>
                            </ul>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- æ§‹æˆè©³ç´°ï¼ˆæŠ˜ã‚ŠãŸãŸã¿å¼ï¼‰ -->
    <div class="structure-details-section">
        <div class="section-header collapsible" onclick="toggleSection('structure-details')">
            <h3>ğŸ”½ æ§‹æˆã®è©³ç´°ã‚’è¦‹ã‚‹</h3>
            <div class="section-actions">
                <button class="btn btn-sm btn-outline-secondary" onclick="event.stopPropagation(); toggleStructureView()">
                    <span id="structure-toggle-icon">â–¼</span>
                </button>
            </div>
        </div>
        <div class="section-content" id="structure-details-content">
            <!-- æ§‹æˆè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div class="structure-view">
                <div class="structure-header">
                    <h3>ğŸ“‹ æ§‹æˆ</h3>
                    <div class="structure-toolbar">
                        <button class="btn btn-sm btn-outline-primary" onclick="addTemplate()">
                            â• ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¿½åŠ 
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="removeTemplate()">
                            â– ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‰Šé™¤
                        </button>
                    </div>
                </div>
                <div class="structure-content" id="structure-content">
                    {% if structure and structure.content and structure.content|length > 0 %}
                        {% if structure.content is mapping and structure.content.error %}
                            <!-- ã‚¨ãƒ©ãƒ¼æ§‹æˆã®å ´åˆ -->
                            <div class="error-structure">
                                <div class="error-message">
                                    <h4>âš ï¸ æ§‹æˆã‚¨ãƒ©ãƒ¼</h4>
                                    <p><strong>{{ structure.content.error }}</strong></p>
                                    {% if structure.content.reason %}
                                        <p><em>ç†ç”±: {{ structure.content.reason }}</em></p>
                                    {% endif %}
                                    {% if structure.content.original_text %}
                                        <details>
                                            <summary>å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆï¼ˆæœ€åˆã®200æ–‡å­—ï¼‰</summary>
                                            <pre>{{ structure.content.original_text }}</pre>
                                        </details>
                                    {% endif %}
                                </div>
                                <div class="error-actions">
                                    <p>ğŸ’¡ è§£æ±ºæ–¹æ³•:</p>
                                    <ul>
                                        <li>ChatGPTã«ã€ŒJSONå½¢å¼ã§æ§‹æˆã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€ã¨æ˜ç¤ºçš„ã«æŒ‡ç¤ºã™ã‚‹</li>
                                        <li>æ§‹æˆã®å†…å®¹ã‚’å…·ä½“çš„ã«æŒ‡å®šã™ã‚‹</li>
                                        <li>åˆ¥ã®è³ªå•ã§æ§‹æˆã‚’å†ç”Ÿæˆã™ã‚‹</li>
                                    </ul>
                                </div>
                            </div>
                        {% else %}
                            <!-- æ­£å¸¸ãªæ§‹æˆã®å ´åˆ -->
                            <pre><code id="structure-display">{{ structure.content | tojson(indent=2) }}</code></pre>
                        {% endif %}
                    {% else %}
                        <!-- æ§‹æˆãŒå­˜åœ¨ã—ãªã„å ´åˆ -->
                        <div class="empty-structure">
                            <div class="empty-message">
                                <h4>ğŸ“‹ æ§‹æˆãŒã¾ã ç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“</h4>
                                <p>ChatGPTã«æ§‹æˆã«ã¤ã„ã¦è³ªå•ã™ã‚‹ã¨ã€ã“ã“ã«æ§‹æˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                                <div class="suggestion-examples">
                                    <p><strong>è³ªå•ä¾‹:</strong></p>
                                    <ul>
                                        <li>ã€ŒWebã‚¢ãƒ—ãƒªã®æ§‹æˆã‚’JSONå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€</li>
                                        <li>ã€Œãƒ–ãƒ­ã‚°ã‚µã‚¤ãƒˆã®æ§‹æˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€</li>
                                        <li>ã€ŒECã‚µã‚¤ãƒˆã®æ©Ÿèƒ½æ§‹æˆã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- æœ€ä¸‹æ®µï¼šãƒ­ã‚°ãƒ»è£œè¶³æƒ…å ±ï¼ˆæŠ˜ã‚ŠãŸãŸã¿å¼ï¼‰ -->
    <div class="logs-section">
        <div class="section-header collapsible" onclick="toggleSection('logs')">
            <h3>ğŸ“Š ãƒ­ã‚°ãƒ»è£œè¶³æƒ…å ±</h3>
            <div class="section-actions">
                <button class="btn btn-sm btn-outline-secondary" onclick="event.stopPropagation(); toggleCodeEditor()">
                    <span id="editor-toggle-icon">â–¼</span>
                </button>
            </div>
        </div>
        <div class="section-content" id="logs-content">
            <!-- ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ‡ã‚£ã‚¿ -->
            <div class="code-editor">
                <div class="editor-header">
                    <h3>âœï¸ ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ‡ã‚£ã‚¿</h3>
                </div>
                <div class="editor-content" id="editor-content">
                    <textarea id="code-editor" placeholder="ã“ã“ã«ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <div class="modules-section">
        {% if structure.modules and structure.modules|length > 0 %}
            {% for module in structure.modules %}
                <div class="module-card">
                    <div class="module-title">{{ module.title or "æœªè¨­å®š" }}</div>
                    <div class="module-desc">{{ module.description or "æœªè¨­å®š" }}</div>
                </div>
            {% endfor %}
        {% else %}
            <div class="no-modules">ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“</div>
        {% endif %}
    </div>
</div> 