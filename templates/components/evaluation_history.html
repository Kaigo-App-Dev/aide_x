<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è©•ä¾¡å±¥æ­´ - {{ structure_id }}</title>
    <style>
        body {
            background: #1e1e1e;
            color: #ccc;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 40px auto;
            background: #252526;
            border-radius: 8px;
            padding: 32px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 16px;
            border-bottom: 1px solid #3e3e42;
        }
        
        .header h1 {
            color: #4ec9b0;
            margin: 0;
            font-size: 24px;
        }
        
        .back-link {
            color: #4ec9b0;
            text-decoration: none;
            font-size: 14px;
            padding: 8px 16px;
            border: 1px solid #4ec9b0;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .back-link:hover {
            background: #4ec9b0;
            color: #1e1e1e;
        }
        
        .meta {
            color: #888;
            font-size: 14px;
            margin-bottom: 24px;
        }
        
        .summary {
            background: #2d2d30;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 24px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .summary-item {
            text-align: center;
        }
        
        .summary-value {
            font-size: 24px;
            font-weight: bold;
            color: #4ec9b0;
            margin-bottom: 4px;
        }
        
        .summary-label {
            font-size: 12px;
            color: #858585;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .history-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }
        
        .history-item {
            background: #2d2d30;
            border-radius: 6px;
            margin-bottom: 16px;
            padding: 20px;
            border-left: 4px solid #4ec9b0;
        }
        
        .history-item:hover {
            background: #3e3e42;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }
        
        .history-meta {
            flex: 1;
        }
        
        .history-timestamp {
            color: #aaa;
            font-size: 13px;
            margin-bottom: 4px;
        }
        
        .history-provider {
            font-size: 14px;
            color: #4ec9b0;
            font-weight: bold;
        }
        
        .history-score {
            font-size: 18px;
            font-weight: bold;
            color: #4ec9b0;
            margin-left: 16px;
        }
        
        .history-content {
            margin-bottom: 16px;
        }
        
        .history-structure-preview {
            background: #1e1e1e;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 12px;
            font-size: 13px;
        }
        
        .history-feedback {
            color: #ccc;
            line-height: 1.5;
            margin-bottom: 12px;
        }
        
        .history-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: #4ec9b0;
            color: #1e1e1e;
        }
        
        .btn-primary:hover {
            background: #45b8a0;
        }
        
        .btn-secondary {
            background: #3e3e42;
            color: #ccc;
        }
        
        .btn-secondary:hover {
            background: #4e4e52;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }
        
        .empty-state h3 {
            margin-bottom: 10px;
            color: #ccc;
        }
        
        .error-message {
            background: #2d2d30;
            border-left: 4px solid #ff6b6b;
            padding: 16px;
            margin-bottom: 24px;
            color: #ff6b6b;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #252526;
            padding: 30px;
            border-radius: 8px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #3e3e42;
        }
        
        .modal-header h3 {
            margin: 0;
            color: #4ec9b0;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: #888;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-close:hover {
            color: #ccc;
        }
        
        .modal-body {
            line-height: 1.6;
        }
        
        .modal-body pre {
            background: #1e1e1e;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        
        .strengths {
            color: #4ec9b0;
            margin-bottom: 12px;
        }
        
        .weaknesses {
            color: #ff6b6b;
            margin-bottom: 12px;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ğŸ“Š è©•ä¾¡å±¥æ­´</h1>
        <a href="/unified/{{ structure_id }}" class="back-link">â† çµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«æˆ»ã‚‹</a>
    </div>
    
    <div class="meta">
        <span>æ§‹æˆID: <b>{{ structure_id }}</b></span>
        {% if structure and structure.title %} | <span>ã‚¿ã‚¤ãƒˆãƒ«: <b>{{ structure.title }}</b></span>{% endif %}
    </div>
    
    {% if error %}
    <div class="error-message">
        <strong>ã‚¨ãƒ©ãƒ¼:</strong> {{ error }}
    </div>
    {% endif %}
    
    {% if summary and summary.total_count > 0 %}
    <div class="summary">
        <h3>ğŸ“ˆ çµ±è¨ˆæƒ…å ±</h3>
        <div class="summary-grid">
            <div class="summary-item">
                <div class="summary-value">{{ summary.total_count }}</div>
                <div class="summary-label">ç·è©•ä¾¡å›æ•°</div>
            </div>
            {% if summary.average_score %}
            <div class="summary-item">
                <div class="summary-value">{{ "%.1f"|format(summary.average_score * 100) }}</div>
                <div class="summary-label">å¹³å‡ã‚¹ã‚³ã‚¢</div>
            </div>
            {% endif %}
            <div class="summary-item">
                <div class="summary-value">{{ summary.providers|length }}</div>
                <div class="summary-label">ä½¿ç”¨ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æ•°</div>
            </div>
            {% if summary.latest_timestamp %}
            <div class="summary-item">
                <div class="summary-value">{{ summary.latest_timestamp[:10] }}</div>
                <div class="summary-label">æœ€æ–°è©•ä¾¡æ—¥</div>
            </div>
            {% endif %}
        </div>
        
        {% if summary.provider_counts %}
        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #3e3e42;">
            <h4>ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼åˆ¥çµ±è¨ˆ:</h4>
            {% for provider, count in summary.provider_counts.items() %}
            <span style="margin-right: 16px; color: #4ec9b0;">{{ provider }}: {{ count }}å›</span>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% endif %}
    
    {% if history %}
    <ul class="history-list">
        {% for entry in history %}
        <li class="history-item" data-index="{{ loop.index0 }}">
            <div class="history-header">
                <div class="history-meta">
                    <div class="history-timestamp">{{ entry.timestamp[:19].replace('T', ' ') if entry.timestamp }}</div>
                    <div class="history-provider">
                        {% if entry.evaluation_result.provider == 'claude' %}
                        ğŸ§  Claudeè©•ä¾¡
                        {% elif entry.evaluation_result.provider == 'gemini' %}
                        âœ¨ Geminiè©•ä¾¡
                        {% else %}
                        ğŸ¤– {{ entry.evaluation_result.provider }}è©•ä¾¡
                        {% endif %}
                    </div>
                </div>
                {% if entry.evaluation_result.score %}
                <div class="history-score">
                    {{ "%.0f"|format(entry.evaluation_result.score * 100) if entry.evaluation_result.score != 'N/A' else 'N/A' }}ç‚¹
                </div>
                {% endif %}
            </div>
            
            <div class="history-content">
                <!-- æ§‹æˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
                <div class="history-structure-preview">
                    <strong>æ§‹æˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼:</strong>
                    {% if entry.structure_before %}
                        {% if entry.structure_before.title %}
                        <div>ğŸ“ ã‚¿ã‚¤ãƒˆãƒ«: {{ entry.structure_before.title }}</div>
                        {% endif %}
                        {% if entry.structure_before.description %}
                        <div>ğŸ“‹ èª¬æ˜: {{ entry.structure_before.description[:100] }}{% if entry.structure_before.description|length > 100 %}...{% endif %}</div>
                        {% endif %}
                        {% if entry.structure_before.content %}
                        <div>âš™ï¸ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ•°: {{ entry.structure_before.content|length }}</div>
                        {% endif %}
                    {% else %}
                        <div>æ§‹æˆãƒ‡ãƒ¼ã‚¿ãªã—</div>
                    {% endif %}
                </div>
                
                <!-- è©•ä¾¡ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ -->
                {% if entry.evaluation_result.feedback %}
                <div class="history-feedback">
                    <strong>ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯:</strong><br>
                    {{ entry.evaluation_result.feedback[:200] }}{% if entry.evaluation_result.feedback|length > 200 %}...{% endif %}
                </div>
                {% endif %}
                
                <!-- å¼·ã¿ãƒ»å¼±ã¿ -->
                {% if entry.evaluation_result.details %}
                    {% if entry.evaluation_result.details.strengths %}
                    <div class="strengths">
                        <strong>âœ… å¼·ã¿:</strong> {{ entry.evaluation_result.details.strengths[:100] }}{% if entry.evaluation_result.details.strengths|length > 100 %}...{% endif %}
                    </div>
                    {% endif %}
                    {% if entry.evaluation_result.details.weaknesses %}
                    <div class="weaknesses">
                        <strong>âš ï¸ å¼±ã¿:</strong> {{ entry.evaluation_result.details.weaknesses[:100] }}{% if entry.evaluation_result.details.weaknesses|length > 100 %}...{% endif %}
                    </div>
                    {% endif %}
                {% endif %}
            </div>
            
            <div class="history-actions">
                <button onclick="showDetail({{ loop.index0 }})" class="btn btn-primary">
                    ğŸ” è©³ç´°è¡¨ç¤º
                </button>
                <button onclick="compareWithCurrent({{ loop.index0 }})" class="btn btn-secondary">
                    ğŸ”„ ç¾åœ¨ã¨æ¯”è¼ƒ
                </button>
            </div>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <div class="empty-state">
        <h3>ğŸ“­ è©•ä¾¡å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</h3>
        <p>ã“ã®æ§‹æˆã®è©•ä¾¡å±¥æ­´ã¯ã¾ã ä¿å­˜ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
        <p>çµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§è©•ä¾¡ã‚’å®Ÿè¡Œã—ã¦ã‹ã‚‰ã€å±¥æ­´ã‚’ä¿å­˜ã—ã¦ãã ã•ã„ã€‚</p>
    </div>
    {% endif %}
</div>

<!-- è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="detailModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">è©•ä¾¡è©³ç´°</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body" id="modalBody">
            <!-- è©³ç´°å†…å®¹ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
        </div>
    </div>
</div>

<script>
// ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
function showDetail(index) {
    const historyData = {{ history | tojson }};
    const entry = historyData[index];
    
    if (!entry) return;
    
    const modal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    
    // ã‚¿ã‚¤ãƒˆãƒ«è¨­å®š
    const timestamp = entry.timestamp ? entry.timestamp.replace('T', ' ').substring(0, 19) : 'Unknown';
    const provider = entry.evaluation_result.provider || 'Unknown';
    modalTitle.textContent = `${provider}è©•ä¾¡è©³ç´° (${timestamp})`;
    
    // å†…å®¹è¨­å®š
    let content = '';
    
    // æ§‹æˆæƒ…å ±
    content += '<h4>ğŸ“‹ è©•ä¾¡å¯¾è±¡æ§‹æˆ</h4>';
    content += '<pre>' + JSON.stringify(entry.structure_before, null, 2) + '</pre>';
    
    // è©•ä¾¡çµæœ
    content += '<h4>ğŸ” è©•ä¾¡çµæœ</h4>';
    if (entry.evaluation_result.score) {
        content += `<p><strong>ã‚¹ã‚³ã‚¢:</strong> ${entry.evaluation_result.score}</p>`;
    }
    if (entry.evaluation_result.feedback) {
        content += `<p><strong>ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯:</strong></p>`;
        content += `<div style="background: #1e1e1e; padding: 12px; border-radius: 4px; margin-bottom: 16px;">${entry.evaluation_result.feedback}</div>`;
    }
    
    // è©³ç´°æƒ…å ±
    if (entry.evaluation_result.details) {
        content += '<h4>ğŸ“Š è©³ç´°æƒ…å ±</h4>';
        content += '<pre>' + JSON.stringify(entry.evaluation_result.details, null, 2) + '</pre>';
    }
    
    modalBody.innerHTML = content;
    modal.style.display = 'block';
}

// ç¾åœ¨ã®æ§‹æˆã¨æ¯”è¼ƒ
function compareWithCurrent(index) {
    const historyData = {{ history | tojson }};
    const entry = historyData[index];
    
    if (!entry) return;
    
    // çµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«é·ç§»ã—ã¦æ¯”è¼ƒè¡¨ç¤º
    const compareUrl = `/unified/{{ structure_id }}?compare=${index}`;
    window.open(compareUrl, '_blank');
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
function closeModal() {
    document.getElementById('detailModal').style.display = 'none';
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
window.onclick = function(event) {
    const modal = document.getElementById('detailModal');
    if (event.target === modal) {
        modal.style.display = 'none';
    }
}
</script>
</body>
</html> 