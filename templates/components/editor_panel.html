<!-- æ§‹æˆã‚¨ãƒ‡ã‚£ã‚¿ãƒ‘ãƒãƒ« -->
<div class="aide-editor-panel">
    <div class="aide-form-group">
        <label class="aide-form-label" for="title">ã‚¿ã‚¤ãƒˆãƒ«</label>
        <input type="text" class="aide-form-control" id="title" value="{{ structure.title }}" placeholder="æ§‹æˆã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›">
    </div>
    
    <div class="aide-form-group">
        <label class="aide-form-label" for="description">èª¬æ˜</label>
        <textarea class="aide-form-control" id="description" rows="3" placeholder="æ§‹æˆã®èª¬æ˜ã‚’å…¥åŠ›">{{ structure.description }}</textarea>
    </div>
    
    <div class="aide-form-group">
        <label class="aide-form-label" for="content">å†…å®¹</label>
        <textarea class="aide-editor-textarea" id="content" placeholder="æ§‹æˆã®å†…å®¹ã‚’å…¥åŠ›">{{ structure.content }}</textarea>
    </div>
    
    <div class="aide-form-group">
        <div class="aide-form-check">
            <input class="aide-form-check-input" type="checkbox" id="is_final" {% if structure.get('is_final') %}checked{% endif %}>
            <label class="aide-form-check-label" for="is_final">
                æœ€çµ‚ç‰ˆã¨ã—ã¦ä¿å­˜
            </label>
        </div>
    </div>
    
    <div class="aide-editor-actions">
        <button class="aide-btn aide-btn-primary" id="saveBtn">
            ğŸ’¾ æ§‹æˆã‚’ä¿å­˜
        </button>
        <button class="aide-btn aide-btn-info" id="generateUiBtn">
            ğŸ¨ Geminiã§UIç”Ÿæˆ
        </button>
    </div>
    
    <!-- UIç”Ÿæˆçµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
    <div id="gemini_ui" class="aide-ui-result" style="display: none;">
        <div class="aide-card">
            <div class="aide-card-header">
                <h5 class="aide-card-title">Gemini UIææ¡ˆ</h5>
            </div>
            <div class="aide-card-body" id="gemini_ui_content">
            </div>
        </div>
    </div>
</div>

<script>
// ã‚¨ãƒ‡ã‚£ã‚¿ãƒ‘ãƒãƒ«ç”¨ã®JavaScript
document.addEventListener('DOMContentLoaded', function() {
    const structureId = '{{ structure.id }}';
    const saveBtn = document.getElementById('saveBtn');
    const generateUiBtn = document.getElementById('generateUiBtn');
    
    // ä¿å­˜æ©Ÿèƒ½
    saveBtn.addEventListener('click', function() {
        const title = document.getElementById('title').value;
        const description = document.getElementById('description').value;
        const content = document.getElementById('content').value;
        const isFinal = document.getElementById('is_final').checked;
        
        if (!title.trim()) {
            alert('ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            return;
        }
        
        saveBtn.disabled = true;
        saveBtn.textContent = 'ä¿å­˜ä¸­...';
        
        fetch(`/unified/${structureId}/save`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                title: title,
                description: description,
                content: content,
                is_final: isFinal
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('æ§‹æˆãŒæ­£å¸¸ã«ä¿å­˜ã•ã‚Œã¾ã—ãŸï¼');
            } else {
                alert('ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + data.error);
            }
        })
        .catch(error => {
            alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            console.error('Error:', error);
        })
        .finally(() => {
            saveBtn.disabled = false;
            saveBtn.textContent = 'ğŸ’¾ æ§‹æˆã‚’ä¿å­˜';
        });
    });
    
    // UIç”Ÿæˆæ©Ÿèƒ½
    generateUiBtn.addEventListener('click', function() {
        const content = document.getElementById('content').value;
        
        if (!content.trim()) {
            alert('å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            return;
        }
        
        generateUiBtn.disabled = true;
        generateUiBtn.textContent = 'ç”Ÿæˆä¸­...';
        
        fetch(`/unified/${structureId}/generate-ui`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                content: content
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const uiResult = document.getElementById('gemini_ui');
                const uiContent = document.getElementById('gemini_ui_content');
                uiContent.innerHTML = data.ui_html;
                uiResult.style.display = 'block';
            } else {
                alert('UIç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + data.error);
            }
        })
        .catch(error => {
            alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            console.error('Error:', error);
        })
        .finally(() => {
            generateUiBtn.disabled = false;
            generateUiBtn.textContent = 'ğŸ¨ Geminiã§UIç”Ÿæˆ';
        });
    });
});
</script> 