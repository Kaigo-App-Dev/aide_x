{% extends "base.html" %}
{% block content %}
<h2>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†</h2>

<!-- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
{% if errors %}
<div style="color: red; border: 1px solid red; padding: 10px; margin-bottom: 15px;">
  <strong>âš  å…¥åŠ›ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã™ï¼š</strong>
  <ul>
    {% for e in errors %}
    <li>{{ e }}</li>
    {% endfor %}
  </ul>
</div>
{% endif %}

<form method="post">
  <label for="title">ã‚¿ã‚¤ãƒˆãƒ«ï¼š</label><br>
  <input type="text" name="title" id="title" value="{{ structure.title }}"><br><br>

  <label for="description">èª¬æ˜ï¼š</label><br>
  <textarea name="description" id="description" rows="3" cols="50">{{ structure.description }}</textarea><br><br>

  <label for="content">æ§‹æˆå†…å®¹ï¼ˆJSONï¼‰ï¼š</label><br>
  <textarea name="content" id="content" rows="15" cols="80">{{ structure.content }}</textarea><br><br>

  <div style="margin-top: 10px;">
    <label>
      <input type="checkbox" name="is_final" {% if structure.is_final %}checked{% endif %}>
      æœ€çµ‚ç¢ºå®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã™ã‚‹
    </label>
  </div>

  <div style="margin-top: 15px;">
     <button type="submit" class="btn btn-success">ğŸ’¾ ä¿å­˜</button>
     <a href="{{ url_for('preview.preview_structure', structure_id=structure.id) }}"
        class="btn btn-info ms-2">ğŸ‘ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</a>
     <a href="{{ url_for('structure.list_structures') }}" class="btn btn-secondary ms-2">â† ä¸€è¦§ã«æˆ»ã‚‹</a>
  </div>
</form>

<form method="get" action="{{ url_for('structure.evaluate_structure', structure_id=structure.id) }}" style="margin-top: 10px;">
  <button type="submit" class="btn btn-warning">ğŸ§ª æ§‹æˆæ•´åˆæ€§ãƒã‚§ãƒƒã‚¯</button>
</form>

<form method="post" action="{{ url_for('structure.decide_structure', structure_id=structure.id) }}" style="margin-top: 10px;">
  <button type="submit">âœ… ã“ã‚Œã§æ±ºå®š</button>
</form>

{% if structure.is_final %}
  <p style="color: green;"><strong>âœ… ã“ã®æ§‹æˆã¯æ¡ç”¨æ¸ˆã¿ã§ã™ã€‚</strong></p>
{% endif %}

{% if structure.history %}
  <hr>
  <h3>ğŸ•“ å±¥æ­´ãƒ­ã‚°</h3>
  <table border="1" cellpadding="6" cellspacing="0">
    <thead>
      <tr>
        <th>æ—¥æ™‚</th>
        <th>æ“ä½œ</th>
        <th>è©³ç´°</th>
      </tr>
    </thead>
    <tbody>
      {% for entry in structure.history|sort(attribute='timestamp', reverse=True) %}
      <tr>
        <td>{{ entry.timestamp[:19]|replace("T", " ") }}</td>
        <td>{{ entry.action }}</td>
        <td>
          {{ entry.detail }}
          {% if entry.snapshot %}
            <form method="post" action="{{ url_for('structure.restore_from_history', structure_id=structure.id) }}" style="display:inline;">
              <input type="hidden" name="timestamp" value="{{ entry.timestamp }}">
              <button type="submit" style="margin-left: 10px;">ğŸ”„ ã“ã®æ™‚ç‚¹ã«æˆ»ã™</button>
            </form>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p><small>å±¥æ­´ã¯ã¾ã è¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</small></p>
{% endif %}

{% endblock %}
