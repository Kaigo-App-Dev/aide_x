<!-- チャット専用テンプレート -->
<div class="chat-messages" id="chatMessages">
  {% set display_count = 0 %}
  {% for msg in msg_list_safe %}
    {% if msg.type in ["assistant_reply", "chat", "user", "note", "confirmation", "revision_request", "confirmation_accepted"] or (msg.role == "assistant" and msg.type is not defined) or (msg.role == "user" and msg.type == "user") %}
      {% set display_count = display_count + 1 %}
      <div class="message {{ msg.role }} {{ msg.type }}"
           data-source="{{ msg.source }}"
           data-type="{{ msg.type }}"
           {% if msg.type == 'confirmation' %}data-testid="confirmation-message"{% endif %}
           {% if msg.type == 'assistant_reply' %}data-testid="assistant-reply"{% endif %}
           {% if msg.role == 'user' %}data-testid="user-message"{% endif %}>
        <div class="message-header">
          {% if msg.type == "assistant_reply" or (msg.role == "assistant" and msg.type is not defined) %}🤖 ChatGPT{% endif %}
          {% if msg.type == "confirmation" %}⚠️ 確認{% endif %}
          {% if msg.type == "revision_request" %}💡 修正依頼{% endif %}
          {% if msg.type == "confirmation_accepted" %}✅ 承認{% endif %}
          {% if msg.role == "user" %}👤 あなた{% endif %}
        </div>
        <div class="message-content">{{ (msg.content if msg.content is defined else msg.text) | safe }}</div>
        {% if msg.timestamp %}
        <div class="message-time">{{ msg.timestamp }}</div>
        {% endif %}
      </div>
    {% endif %}
  {% endfor %}
  {% if display_count == 0 %}
    <div style="text-align: center; padding: 20px; color: #858585;">
      <p>メッセージがありません</p>
      <p style="font-size: 12px; margin-top: 8px;">構成について質問してみましょう！</p>
    </div>
  {% endif %}
</div>

<!-- チャット入力エリア -->
<div class="chat-input-container">
    <div class="chat-input">
        <input type="text" id="chat-input" placeholder="構成について質問してください...">
        <button type="button" id="send-button">送信</button>
    </div>
</div>

<!-- AI操作ボタン -->
<div class="ai-action-bar">
    <button id="saveStructureBtn" class="btn btn-primary">
        💾 構成保存
    </button>
    <button id="completeGeminiBtn" class="btn btn-complete">
        ✨ Gemini補完
    </button>
    <button id="generateUIBtn" class="btn btn-ui">
        🎨 UI生成
    </button>
</div>

<!-- 操作フィードバック表示エリア -->
<div id="operationFeedback"></div> 