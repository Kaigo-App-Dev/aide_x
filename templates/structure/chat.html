<!-- ãƒãƒ£ãƒƒãƒˆå°‚ç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ -->
<div class="chat-messages" id="chatMessages">
  {% set display_count = 0 %}
  {% for msg in msg_list_safe %}
    {% if msg.type in ["assistant_reply", "chat", "user", "note", "confirmation", "revision_request", "confirmation_accepted"] or (msg.role == "assistant" and msg.type is not defined) or (msg.role == "user" and msg.type == "user") %}
      {% set display_count = display_count + 1 %}
      <div class="message {{ msg.role }} {{ msg.type }}"
           data-source="{{ msg.source }}"
           data-type="{{ msg.type }}"
           {% if msg.type == 'confirmation' %}data-testid="confirmation-message"{% endif %}
           {% if msg.type == 'assistant_reply' %}data-testid="assistant-reply"{% endif %}
           {% if msg.role == 'user' %}data-testid="user-message"{% endif %}>
        <div class="message-header">
          {% if msg.type == "assistant_reply" or (msg.role == "assistant" and msg.type is not defined) %}ğŸ¤– ChatGPT{% endif %}
          {% if msg.type == "confirmation" %}âš ï¸ ç¢ºèª{% endif %}
          {% if msg.type == "revision_request" %}ğŸ’¡ ä¿®æ­£ä¾é ¼{% endif %}
          {% if msg.type == "confirmation_accepted" %}âœ… æ‰¿èª{% endif %}
          {% if msg.role == "user" %}ğŸ‘¤ ã‚ãªãŸ{% endif %}
        </div>
        <div class="message-content">{{ (msg.content if msg.content is defined else msg.text) | safe }}</div>
        {% if msg.timestamp %}
        <div class="message-time">{{ msg.timestamp }}</div>
        {% endif %}
      </div>
    {% endif %}
  {% endfor %}
  {% if display_count == 0 %}
    <div style="text-align: center; padding: 20px; color: #858585;">
      <p>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã›ã‚“</p>
      <p style="font-size: 12px; margin-top: 8px;">æ§‹æˆã«ã¤ã„ã¦è³ªå•ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼</p>
    </div>
  {% endif %}
</div>

<!-- ãƒãƒ£ãƒƒãƒˆå…¥åŠ›ã‚¨ãƒªã‚¢ -->
<div class="chat-input-container">
    <div class="chat-input">
        <input type="text" id="chat-input" placeholder="æ§‹æˆã«ã¤ã„ã¦è³ªå•ã—ã¦ãã ã•ã„...">
        <button type="button" id="send-button">é€ä¿¡</button>
    </div>
</div>

<!-- AIæ“ä½œãƒœã‚¿ãƒ³ -->
<div class="ai-action-bar">
    <button id="saveStructureBtn" class="btn btn-primary">
        ğŸ’¾ æ§‹æˆä¿å­˜
    </button>
    <button id="completeGeminiBtn" class="btn btn-complete">
        âœ¨ Geminiè£œå®Œ
    </button>
    <button id="generateUIBtn" class="btn btn-ui">
        ğŸ¨ UIç”Ÿæˆ
    </button>
</div>

<!-- æ“ä½œãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
<div id="operationFeedback"></div> 