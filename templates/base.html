<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- åŸºæœ¬ãƒ¡ã‚¿æƒ…å ± -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- CSRFãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ï¼‰ -->
    {% if csrf_token is defined %}
    <meta name="csrf-token" content="{{ csrf_token() }}">
    {% endif %}
    
    <!-- ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ« -->
    <title>{% block title %}AIDE-X{% endblock %}</title>
    
    <!-- å…±é€šCSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    
    <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" 
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" 
            crossorigin="anonymous"></script>
    
    <!-- è¿½åŠ ã®headè¦ç´ ï¼ˆå­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ä½¿ç”¨ï¼‰ -->
    {% block head %}{% endblock %}
</head>
<body>
    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="main-container">
        <!-- ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div id="flash-messages" class="flash-container">
                    {% for category, message in messages %}
                        <div class="flash-message flash-{{ category }}">
                            <span class="flash-text">{{ message }}</span>
                            <button class="flash-close" onclick="this.parentElement.remove()">&times;</button>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
        <nav id="main-nav" class="main-navigation">
            <div class="nav-container">
                <div class="nav-brand">
                    <a href="{{ url_for('chat.chat_prompt') }}" class="nav-link">
                        ğŸ§  AIDE-X
                    </a>
                </div>
                
                <div class="nav-menu">
                    <a href="{{ url_for('chat.chat_prompt') }}" class="nav-link">
                        ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ
                    </a>
                    <a href="{{ url_for('structure.list_structures') }}" class="nav-link">
                        ğŸ“ æ§‹æˆä¸€è¦§
                    </a>
                    <a href="{{ url_for('structure.unified_interface', structure_id='test') }}" class="nav-link">
                        ğŸ”§ çµ±åˆç”»é¢
                    </a>
                    <a href="{{ url_for('evolve.index') }}" class="nav-link">
                        ğŸ”„ é€²åŒ–
                    </a>
                </div>
                
                <!-- ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
                <button id="mobile-menu-toggle" class="mobile-menu-toggle" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </nav>
        
        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
        <main id="main-content" class="main-content">
            {% block content %}{% endblock %}
        </main>
        
        <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
        <footer id="main-footer" class="main-footer">
            <div class="footer-container">
                <p>&copy; 2024 AIDE-X. All rights reserved.</p>
            </div>
        </footer>
    </div>
    
    <!-- è¿½åŠ ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆå­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ä½¿ç”¨ï¼‰ -->
    {% block scripts %}{% endblock %}
    
    <!-- å…±é€šJavaScript -->
    <script>
        // ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®åˆ¶å¾¡
        $(document).ready(function() {
            $('#mobile-menu-toggle').on('click', function() {
                $('.nav-menu').toggleClass('active');
                $(this).toggleClass('active');
            });
            
            // ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è‡ªå‹•æ¶ˆå»
            $('.flash-message').each(function() {
                var $message = $(this);
                setTimeout(function() {
                    $message.fadeOut(300, function() {
                        $(this).remove();
                    });
                }, 5000);
            });
            
            // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼šã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã®å‡¦ç†
            $(window).on('resize', function() {
                if ($(window).width() > 768) {
                    $('.nav-menu').removeClass('active');
                    $('#mobile-menu-toggle').removeClass('active');
                }
            });
        });
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        window.addEventListener('error', function(e) {
            console.error('JavaScript Error:', e.error);
        });
        
        // Ajaxé€šä¿¡ã®å…±é€šè¨­å®š
        $.ajaxSetup({
            beforeSend: function(xhr) {
                // CSRFãƒˆãƒ¼ã‚¯ãƒ³ã®è‡ªå‹•ä»˜ä¸
                var token = $('meta[name="csrf-token"]').attr('content');
                if (token) {
                    xhr.setRequestHeader('X-CSRFToken', token);
                }
            },
            error: function(xhr, status, error) {
                console.error('Ajax Error:', status, error);
                // ã‚¨ãƒ©ãƒ¼æ™‚ã®å…±é€šå‡¦ç†
                if (xhr.status === 401) {
                    alert('èªè¨¼ãŒå¿…è¦ã§ã™ã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚');
                } else if (xhr.status === 403) {
                    alert('ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
                } else if (xhr.status >= 500) {
                    alert('ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
                }
            }
        });
    </script>
</body>
</html>
