<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}AIDE-X{% endblock %}</title>
    
    <!-- VSCodeÈ¢®„É°„Éã„É•„Éº„Éê„Éº„ÅÆ„Çπ„Çø„Ç§„É´ -->
    <style>
        /* „É°„Éã„É•„Éº„Éê„Éº */
        .menu-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #1e1e1e;
            color: #cccccc;
            border-bottom: 1px solid #3c3c3c;
            z-index: 1000;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 13px;
        }
        
        .menu-bar nav {
            display: flex;
            align-items: center;
            padding: 0 16px;
            height: 30px;
        }
        
        .menu-bar .logo {
            font-weight: bold;
            font-size: 14px;
            margin-right: 24px;
            color: #007acc;
        }
        
        .menu-bar .menu-item {
            padding: 4px 8px;
            cursor: pointer;
            border-radius: 3px;
            transition: background-color 0.2s;
            user-select: none;
        }
        
        .menu-bar .menu-item:hover {
            background-color: #2a2d2e;
        }
        
        .menu-bar .menu-item:active {
            background-color: #094771;
        }
        
        .menu-bar .menu-separator {
            width: 1px;
            height: 16px;
            background-color: #3c3c3c;
            margin: 0 8px;
        }
        
        /* „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢ */
        .main-content {
            margin-top: 30px; /* „É°„Éã„É•„Éº„Éê„Éº„ÅÆÈ´ò„ÅïÂàÜ */
            min-height: calc(100vh - 30px);
        }
        
        /* „Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„É°„Éã„É•„Éº */
        .menu-dropdown {
            position: absolute;
            top: 30px;
            background: #252526;
            border: 1px solid #3c3c3c;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            min-width: 160px;
            padding: 4px 0;
        }
        
        .menu-dropdown-item {
            padding: 8px 16px;
            cursor: pointer;
            font-size: 12px;
            color: #cccccc;
            transition: background-color 0.2s;
        }
        
        .menu-dropdown-item:hover {
            background-color: #094771;
        }
        
        .menu-separator-horizontal {
            height: 1px;
            background-color: #3c3c3c;
            margin: 4px 0;
        }
        
        /* Â±•Ê≠¥Ê¨Ñ„ÅÆË°®Á§∫ÂàáÊõø */
        .history-panel {
            transition: width 0.3s ease;
        }
        
        .history-panel.collapsed {
            width: 0 !important;
            overflow: hidden;
        }
        
        /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
        @media (max-width: 768px) {
            .menu-bar nav {
                padding: 0 8px;
            }
            
            .menu-bar .menu-item {
                padding: 4px 6px;
                font-size: 12px;
            }
            
            .menu-bar .logo {
                margin-right: 16px;
                font-size: 13px;
            }
            
            .menu-dropdown {
                min-width: 140px;
            }
        }
    </style>
    
    {% block head %}{% endblock %}
</head>
<body>
    <!-- VSCodeÈ¢®„É°„Éã„É•„Éº„Éê„Éº -->
    <header class="menu-bar">
        <nav>
            <div class="logo">üß† AIDE-X</div>
            
            <!-- „Éï„Ç°„Ç§„É´„É°„Éã„É•„Éº -->
            <div class="menu-item" onclick="toggleFileMenu()">
                „Éï„Ç°„Ç§„É´ ‚ñæ
            </div>
            <div id="fileMenu" class="menu-dropdown" style="display: none;">
                <div class="menu-dropdown-item" onclick="window.location.href='/unified/new'">Êñ∞Ë¶èÊßãÊàê</div>
                <div class="menu-dropdown-item" onclick="saveStructure()">‰øùÂ≠ò</div>
                <div class="menu-dropdown-item" onclick="exportStructure()">„Ç®„ÇØ„Çπ„Éù„Éº„Éà</div>
                <div class="menu-separator-horizontal"></div>
                <div class="menu-dropdown-item" onclick="window.close()">ÁµÇ‰∫Ü</div>
            </div>
            
            <!-- Á∑®ÈõÜ„É°„Éã„É•„Éº -->
            <div class="menu-item" onclick="toggleEditMenu()">
                Á∑®ÈõÜ ‚ñæ
            </div>
            <div id="editMenu" class="menu-dropdown" style="display: none;">
                <div class="menu-dropdown-item" onclick="undoAction()">ÂÖÉ„Å´Êàª„Åô</div>
                <div class="menu-dropdown-item" onclick="redoAction()">„ÇÑ„ÇäÁõ¥„Åó</div>
                <div class="menu-separator-horizontal"></div>
                <div class="menu-dropdown-item" onclick="clearHistory()">Â±•Ê≠¥„Çí„ÇØ„É™„Ç¢</div>
            </div>
            
            <!-- Ë°®Á§∫„É°„Éã„É•„Éº -->
            <div class="menu-item" onclick="toggleViewMenu()">
                Ë°®Á§∫ ‚ñæ
            </div>
            <div id="viewMenu" class="menu-dropdown" style="display: none;">
                <div class="menu-dropdown-item" onclick="toggleHistoryPanel()">
                    <span id="historyToggleText">Â±•Ê≠¥Ê¨Ñ„ÇíË°®Á§∫</span>
                </div>
                <div class="menu-dropdown-item" onclick="toggleEvaluationPanel()">
                    <span id="evaluationToggleText">Ë©ï‰æ°Ê¨Ñ„ÇíË°®Á§∫</span>
                </div>
                <div class="menu-separator-horizontal"></div>
                <div class="menu-dropdown-item" onclick="openEvaluationHistory()">Ë©ï‰æ°Â±•Ê≠¥„Éö„Éº„Ç∏</div>
                <div class="menu-dropdown-item" onclick="openCompletionHistory()">Ë£úÂÆåÂ±•Ê≠¥„Éö„Éº„Ç∏</div>
                <div class="menu-separator-horizontal"></div>
                <div class="menu-dropdown-item" onclick="resetLayout()">„É¨„Ç§„Ç¢„Ç¶„Éà„Çí„É™„Çª„ÉÉ„Éà</div>
            </div>
            
            <!-- Ë©ï‰æ°„É°„Éã„É•„Éº -->
            <div class="menu-item" onclick="toggleEvaluationMenu()">
                Ë©ï‰æ° ‚ñæ
            </div>
            <div id="evaluationMenu" class="menu-dropdown" style="display: none;">
                <div class="menu-dropdown-item" onclick="evaluateWithClaude()">Claude„ÅßË©ï‰æ°</div>
                <div class="menu-dropdown-item" onclick="evaluateWithGemini()">Gemini„ÅßË©ï‰æ°</div>
                <div class="menu-separator-horizontal"></div>
                <div class="menu-dropdown-item" onclick="viewEvaluationHistory()">Ë©ï‰æ°Â±•Ê≠¥</div>
            </div>
            
            <div class="menu-separator"></div>
            
            <!-- „Éò„É´„Éó„É°„Éã„É•„Éº -->
            <div class="menu-item" onclick="toggleHelpMenu()">
                „Éò„É´„Éó ‚ñæ
            </div>
            <div id="helpMenu" class="menu-dropdown" style="display: none;">
                <div class="menu-dropdown-item" onclick="openHelp()">‰Ωø„ÅÑÊñπ</div>
                <div class="menu-dropdown-item" onclick="openAbout()">„Éê„Éº„Ç∏„Éß„É≥ÊÉÖÂ†±</div>
                <div class="menu-separator-horizontal"></div>
                <div class="menu-dropdown-item" onclick="openKeyboardShortcuts()">„Ç≠„Éº„Éú„Éº„Éâ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà</div>
            </div>
        </nav>
    </header>
    
    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <div class="main-content">
        {% block content %}{% endblock %}
    </div>
    
    <!-- ÂÖ±ÈÄöJavaScript -->
    <script>
        // „É°„Éã„É•„ÉºÂà∂Âæ°
        let activeMenu = null;
        
        function toggleFileMenu() {
            toggleMenu('fileMenu');
        }
        
        function toggleEditMenu() {
            toggleMenu('editMenu');
        }
        
        function toggleViewMenu() {
            toggleMenu('viewMenu');
        }
        
        function toggleEvaluationMenu() {
            toggleMenu('evaluationMenu');
        }
        
        function toggleHelpMenu() {
            toggleMenu('helpMenu');
        }
        
        function toggleMenu(menuId) {
            const menu = document.getElementById(menuId);
            const allMenus = document.querySelectorAll('.menu-dropdown');
            
            // ‰ªñ„ÅÆ„É°„Éã„É•„Éº„ÇíÈñâ„Åò„Çã
            allMenus.forEach(m => {
                if (m.id !== menuId) {
                    m.style.display = 'none';
                }
            });
            
            // ÁèæÂú®„ÅÆ„É°„Éã„É•„Éº„ÇíÂàá„ÇäÊõø„Åà
            if (menu.style.display === 'none' || menu.style.display === '') {
                menu.style.display = 'block';
                activeMenu = menuId;
            } else {
                menu.style.display = 'none';
                activeMenu = null;
            }
        }
        
        // „É°„Éã„É•„ÉºÂ§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.menu-item') && !event.target.closest('.menu-dropdown')) {
                const allMenus = document.querySelectorAll('.menu-dropdown');
                allMenus.forEach(menu => {
                    menu.style.display = 'none';
                });
                activeMenu = null;
            }
        });
        
        // Â±•Ê≠¥Ê¨Ñ„ÅÆË°®Á§∫ÂàáÊõø
        let historyPanelVisible = false;
        let evaluationPanelVisible = false;
        
        function toggleHistoryPanel() {
            const historyPanel = document.querySelector('.history-panel');
            const toggleText = document.getElementById('historyToggleText');
            
            if (historyPanel) {
                historyPanelVisible = !historyPanelVisible;
                if (historyPanelVisible) {
                    historyPanel.classList.remove('collapsed');
                    toggleText.textContent = 'Â±•Ê≠¥Ê¨Ñ„ÇíÈùûË°®Á§∫';
                } else {
                    historyPanel.classList.add('collapsed');
                    toggleText.textContent = 'Â±•Ê≠¥Ê¨Ñ„ÇíË°®Á§∫';
                }
            }
        }
        
        function toggleEvaluationPanel() {
            const evaluationPanel = document.querySelector('.evaluation-panel');
            const toggleText = document.getElementById('evaluationToggleText');
            
            if (evaluationPanel) {
                evaluationPanelVisible = !evaluationPanelVisible;
                if (evaluationPanelVisible) {
                    evaluationPanel.classList.remove('collapsed');
                    toggleText.textContent = 'Ë©ï‰æ°Ê¨Ñ„ÇíÈùûË°®Á§∫';
                } else {
                    evaluationPanel.classList.add('collapsed');
                    toggleText.textContent = 'Ë©ï‰æ°Ê¨Ñ„ÇíË°®Á§∫';
                }
            }
        }
        
        function resetLayout() {
            // „É¨„Ç§„Ç¢„Ç¶„Éà„Çí„É™„Çª„ÉÉ„Éà
            const panels = document.querySelectorAll('.history-panel, .evaluation-panel');
            panels.forEach(panel => {
                panel.classList.remove('collapsed');
            });
            historyPanelVisible = true;
            evaluationPanelVisible = true;
            
            const toggleTexts = document.querySelectorAll('#historyToggleText, #evaluationToggleText');
            toggleTexts.forEach(text => {
                if (text.id === 'historyToggleText') {
                    text.textContent = 'Â±•Ê≠¥Ê¨Ñ„ÇíÈùûË°®Á§∫';
                } else if (text.id === 'evaluationToggleText') {
                    text.textContent = 'Ë©ï‰æ°Ê¨Ñ„ÇíÈùûË°®Á§∫';
                }
            });
        }
        
        // ‰øùÂ≠òÊ©üËÉΩ
        function saveStructure() {
            if (typeof window.saveStructure === 'function') {
                window.saveStructure();
            } else {
                console.log('‰øùÂ≠òÊ©üËÉΩ„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì');
            }
        }
        
        // Ë©ï‰æ°Ê©üËÉΩ
        function evaluateStructure() {
            if (typeof window.evaluateStructure === 'function') {
                window.evaluateStructure();
            } else {
                console.log('Ë©ï‰æ°Ê©üËÉΩ„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì');
            }
        }
        
        function evaluateWithClaude() {
            if (typeof window.evaluateWithClaude === 'function') {
                window.evaluateWithClaude();
            } else {
                console.log('ClaudeË©ï‰æ°Ê©üËÉΩ„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì');
            }
        }
        
        function evaluateWithGemini() {
            if (typeof window.evaluateWithGemini === 'function') {
                window.evaluateWithGemini();
            } else {
                console.log('GeminiË©ï‰æ°Ê©üËÉΩ„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì');
            }
        }
        
        // Â∑ÆÂàÜË°®Á§∫Ê©üËÉΩ
        function toggleDiff() {
            if (typeof window.toggleDiff === 'function') {
                window.toggleDiff();
            } else {
                console.log('Â∑ÆÂàÜË°®Á§∫Ê©üËÉΩ„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì');
            }
        }
        
        // „Åù„ÅÆ‰ªñ„ÅÆÊ©üËÉΩ
        function exportStructure() {
            console.log('„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÊ©üËÉΩ');
        }
        
        function undoAction() {
            console.log('ÂÖÉ„Å´Êàª„Åô');
        }
        
        function redoAction() {
            console.log('„ÇÑ„ÇäÁõ¥„Åó');
        }
        
        function clearHistory() {
            console.log('Â±•Ê≠¥„Çí„ÇØ„É™„Ç¢');
        }
        
        function viewEvaluationHistory() {
            console.log('Ë©ï‰æ°Â±•Ê≠¥„ÇíË°®Á§∫');
        }
        
        function openAbout() {
            window.open('/about', '_blank');
        }
        
        function openKeyboardShortcuts() {
            window.open('/help#shortcuts', '_blank');
        }
        
        // „Éò„É´„ÉóÊ©üËÉΩ
        function openHelp() {
            window.open('/help', '_blank');
        }
        
        // Â±•Ê≠¥„Éö„Éº„Ç∏„Å∏„ÅÆ„É™„É≥„ÇØÊ©üËÉΩ
        function openEvaluationHistory() {
            const structureId = getCurrentStructureId();
            if (structureId) {
                window.open(`/unified/structure/${structureId}/evaluation_history`, '_blank');
            } else {
                console.log('ÊßãÈÄ†ID„ÅåÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì');
            }
        }
        
        function openCompletionHistory() {
            const structureId = getCurrentStructureId();
            if (structureId) {
                window.open(`/unified/structure/${structureId}/completion_history`, '_blank');
            } else {
                console.log('ÊßãÈÄ†ID„ÅåÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì');
            }
        }
        
        function getCurrentStructureId() {
            // URL„Åã„ÇâÊßãÈÄ†ID„ÇíÂèñÂæó
            const path = window.location.pathname;
            const match = path.match(/\/unified\/([^\/]+)/);
            return match ? match[1] : null;
        }
        
        // ÂàùÊúüÂåñÊôÇ„Å´Â±•Ê≠¥Ê¨Ñ„ÇíÈùûË°®Á§∫„Å´„Åô„Çã
        document.addEventListener('DOMContentLoaded', function() {
            const historyPanel = document.querySelector('.history-panel');
            const evaluationPanel = document.querySelector('.evaluation-panel');
            
            if (historyPanel) {
                historyPanel.classList.add('collapsed');
                historyPanelVisible = false;
            }
            
            if (evaluationPanel) {
                evaluationPanel.classList.add('collapsed');
                evaluationPanelVisible = false;
            }
        });
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html> 