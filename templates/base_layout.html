<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}AIDE-X{% endblock %}</title>
    
    <!-- VSCodeé¢¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« -->
    <style>
        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ */
        .menu-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #1e1e1e;
            color: #cccccc;
            border-bottom: 1px solid #3c3c3c;
            z-index: 1000;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 13px;
        }
        
        .menu-bar nav {
            display: flex;
            align-items: center;
            padding: 0 16px;
            height: 30px;
        }
        
        .menu-bar .logo {
            font-weight: bold;
            font-size: 14px;
            margin-right: 24px;
            color: #007acc;
        }
        
        .menu-bar .menu-item {
            padding: 4px 8px;
            cursor: pointer;
            border-radius: 3px;
            transition: background-color 0.2s;
            user-select: none;
        }
        
        .menu-bar .menu-item:hover {
            background-color: #2a2d2e;
        }
        
        .menu-bar .menu-item:active {
            background-color: #094771;
        }
        
        .menu-bar .menu-separator {
            width: 1px;
            height: 16px;
            background-color: #3c3c3c;
            margin: 0 8px;
        }
        
        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ */
        .main-content {
            margin-top: 30px; /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã®é«˜ã•åˆ† */
            min-height: calc(100vh - 30px);
        }
        
        /* ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
        .menu-dropdown {
            position: absolute;
            top: 30px;
            background: #252526;
            border: 1px solid #3c3c3c;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            min-width: 160px;
            padding: 4px 0;
        }
        
        .menu-dropdown-item {
            padding: 8px 16px;
            cursor: pointer;
            font-size: 12px;
            color: #cccccc;
            transition: background-color 0.2s;
        }
        
        .menu-dropdown-item:hover {
            background-color: #094771;
        }
        
        .menu-separator-horizontal {
            height: 1px;
            background-color: #3c3c3c;
            margin: 4px 0;
        }
        
        /* å±¥æ­´æ¬„ã®è¡¨ç¤ºåˆ‡æ›¿ */
        .history-panel {
            transition: width 0.3s ease;
        }
        
        .history-panel.collapsed {
            width: 0 !important;
            overflow: hidden;
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .menu-bar nav {
                padding: 0 8px;
            }
            
            .menu-bar .menu-item {
                padding: 4px 6px;
                font-size: 12px;
            }
            
            .menu-bar .logo {
                margin-right: 16px;
                font-size: 13px;
            }
            
            .menu-dropdown {
                min-width: 140px;
            }
        }
    </style>
    
    {% block head %}{% endblock %}
</head>
<body>
    <!-- VSCodeé¢¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ -->
    <header class="menu-bar">
        <nav>
            <div class="logo">ğŸ§  AIDE-X</div>
            
            <!-- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
            <div class="menu-item" onclick="toggleFileMenu()">
                ãƒ•ã‚¡ã‚¤ãƒ« â–¾
            </div>
            <div id="fileMenu" class="menu-dropdown" style="display: none;">
                <div class="menu-dropdown-item" onclick="window.location.href='/unified/new'">æ–°è¦æ§‹æˆ</div>
                <div class="menu-dropdown-item" onclick="saveStructure()">ä¿å­˜</div>
                <div class="menu-dropdown-item" onclick="exportStructure()">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</div>
                <div class="menu-separator-horizontal"></div>
                <div class="menu-dropdown-item" onclick="window.close()">çµ‚äº†</div>
            </div>
            
            <!-- ç·¨é›†ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
            <div class="menu-item" onclick="toggleEditMenu()">
                ç·¨é›† â–¾
            </div>
            <div id="editMenu" class="menu-dropdown" style="display: none;">
                <div class="menu-dropdown-item" onclick="undoAction()">å…ƒã«æˆ»ã™</div>
                <div class="menu-dropdown-item" onclick="redoAction()">ã‚„ã‚Šç›´ã—</div>
                <div class="menu-separator-horizontal"></div>
                <div class="menu-dropdown-item" onclick="clearHistory()">å±¥æ­´ã‚’ã‚¯ãƒªã‚¢</div>
            </div>
            
            <!-- è¡¨ç¤ºãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
            <div class="menu-item" onclick="toggleViewMenu()">
                è¡¨ç¤º â–¾
            </div>
            <div id="viewMenu" class="menu-dropdown" style="display: none;">
                <div class="menu-dropdown-item" onclick="toggleHistoryPanel()">
                    <span id="historyToggleText">å±¥æ­´æ¬„ã‚’è¡¨ç¤º</span>
                </div>
                <div class="menu-dropdown-item" onclick="toggleEvaluationPanel()">
                    <span id="evaluationToggleText">è©•ä¾¡æ¬„ã‚’è¡¨ç¤º</span>
                </div>
                <div class="menu-separator-horizontal"></div>
                <div class="menu-dropdown-item" onclick="openEvaluationHistory()">è©•ä¾¡å±¥æ­´ãƒšãƒ¼ã‚¸</div>
                <div class="menu-dropdown-item" onclick="openCompletionHistory()">è£œå®Œå±¥æ­´ãƒšãƒ¼ã‚¸</div>
                <div class="menu-separator-horizontal"></div>
                <div class="menu-dropdown-item" onclick="resetLayout()">ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ</div>
            </div>
            
            <!-- è©•ä¾¡ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
            <div class="menu-item" onclick="toggleEvaluationMenu()">
                è©•ä¾¡ â–¾
            </div>
            <div id="evaluationMenu" class="menu-dropdown" style="display: none;">
                <div class="menu-dropdown-item" onclick="evaluateWithClaude()">Claudeã§è©•ä¾¡</div>
                <div class="menu-dropdown-item" onclick="evaluateWithGemini()">Geminiã§è©•ä¾¡</div>
                <div class="menu-separator-horizontal"></div>
                <div class="menu-dropdown-item" onclick="viewEvaluationHistory()">è©•ä¾¡å±¥æ­´</div>
            </div>
            
            <div class="menu-separator"></div>
            
            <!-- ãƒ˜ãƒ«ãƒ—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
            <div class="menu-item" onclick="toggleHelpMenu()">
                ãƒ˜ãƒ«ãƒ— â–¾
            </div>
            <div id="helpMenu" class="menu-dropdown" style="display: none;">
                <div class="menu-dropdown-item" onclick="openHelp()">ä½¿ã„æ–¹</div>
                <div class="menu-dropdown-item" onclick="openAbout()">ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±</div>
                <div class="menu-separator-horizontal"></div>
                <div class="menu-dropdown-item" onclick="openKeyboardShortcuts()">ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ</div>
            </div>
        </nav>
    </header>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="main-content">
        {% block content %}{% endblock %}
    </div>
    
    <!-- å…±é€šJavaScript -->
    <script>
        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼åˆ¶å¾¡
        let activeMenu = null;
        
        function toggleFileMenu() {
            toggleMenu('fileMenu');
        }
        
        function toggleEditMenu() {
            toggleMenu('editMenu');
        }
        
        function toggleViewMenu() {
            toggleMenu('viewMenu');
        }
        
        function toggleEvaluationMenu() {
            toggleMenu('evaluationMenu');
        }
        
        function toggleHelpMenu() {
            toggleMenu('helpMenu');
        }
        
        function toggleMenu(menuId) {
            const menu = document.getElementById(menuId);
            const allMenus = document.querySelectorAll('.menu-dropdown');
            
            // ä»–ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
            allMenus.forEach(m => {
                if (m.id !== menuId) {
                    m.style.display = 'none';
                }
            });
            
            // ç¾åœ¨ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’åˆ‡ã‚Šæ›¿ãˆ
            if (menu.style.display === 'none' || menu.style.display === '') {
                menu.style.display = 'block';
                activeMenu = menuId;
            } else {
                menu.style.display = 'none';
                activeMenu = null;
            }
        }
        
        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.menu-item') && !event.target.closest('.menu-dropdown')) {
                const allMenus = document.querySelectorAll('.menu-dropdown');
                allMenus.forEach(menu => {
                    menu.style.display = 'none';
                });
                activeMenu = null;
            }
        });
        
        // å±¥æ­´æ¬„ã®è¡¨ç¤ºåˆ‡æ›¿
        let historyPanelVisible = false;
        let evaluationPanelVisible = false;
        
        function toggleHistoryPanel() {
            const historyPanel = document.querySelector('.history-panel');
            const toggleText = document.getElementById('historyToggleText');
            
            if (historyPanel) {
                historyPanelVisible = !historyPanelVisible;
                if (historyPanelVisible) {
                    historyPanel.classList.remove('collapsed');
                    toggleText.textContent = 'å±¥æ­´æ¬„ã‚’éè¡¨ç¤º';
                } else {
                    historyPanel.classList.add('collapsed');
                    toggleText.textContent = 'å±¥æ­´æ¬„ã‚’è¡¨ç¤º';
                }
            }
        }
        
        function toggleEvaluationPanel() {
            const evaluationPanel = document.querySelector('.evaluation-panel');
            const toggleText = document.getElementById('evaluationToggleText');
            
            if (evaluationPanel) {
                evaluationPanelVisible = !evaluationPanelVisible;
                if (evaluationPanelVisible) {
                    evaluationPanel.classList.remove('collapsed');
                    toggleText.textContent = 'è©•ä¾¡æ¬„ã‚’éè¡¨ç¤º';
                } else {
                    evaluationPanel.classList.add('collapsed');
                    toggleText.textContent = 'è©•ä¾¡æ¬„ã‚’è¡¨ç¤º';
                }
            }
        }
        
        function resetLayout() {
            // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
            const panels = document.querySelectorAll('.history-panel, .evaluation-panel');
            panels.forEach(panel => {
                panel.classList.remove('collapsed');
            });
            historyPanelVisible = true;
            evaluationPanelVisible = true;
            
            const toggleTexts = document.querySelectorAll('#historyToggleText, #evaluationToggleText');
            toggleTexts.forEach(text => {
                if (text.id === 'historyToggleText') {
                    text.textContent = 'å±¥æ­´æ¬„ã‚’éè¡¨ç¤º';
                } else if (text.id === 'evaluationToggleText') {
                    text.textContent = 'è©•ä¾¡æ¬„ã‚’éè¡¨ç¤º';
                }
            });
        }
        
        // ä¿å­˜æ©Ÿèƒ½
        function saveStructure() {
            if (typeof window.saveStructure === 'function') {
                window.saveStructure();
            } else {
                console.log('ä¿å­˜æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
            }
        }
        
        // è©•ä¾¡æ©Ÿèƒ½
        function evaluateStructure() {
            if (typeof window.evaluateStructure === 'function') {
                window.evaluateStructure();
            } else {
                console.log('è©•ä¾¡æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
            }
        }
        
        function evaluateWithClaude() {
            if (typeof window.evaluateWithClaude === 'function') {
                window.evaluateWithClaude();
            } else {
                console.log('Claudeè©•ä¾¡æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
            }
        }
        
        function evaluateWithGemini() {
            if (typeof window.evaluateWithGemini === 'function') {
                window.evaluateWithGemini();
            } else {
                console.log('Geminiè©•ä¾¡æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
            }
        }
        
        // å·®åˆ†è¡¨ç¤ºæ©Ÿèƒ½
        function toggleDiff() {
            if (typeof window.toggleDiff === 'function') {
                window.toggleDiff();
            } else {
                console.log('å·®åˆ†è¡¨ç¤ºæ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
            }
        }
        
        // ãã®ä»–ã®æ©Ÿèƒ½
        function exportStructure() {
            console.log('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½');
        }
        
        function undoAction() {
            console.log('å…ƒã«æˆ»ã™');
        }
        
        function redoAction() {
            console.log('ã‚„ã‚Šç›´ã—');
        }
        
        function clearHistory() {
            console.log('å±¥æ­´ã‚’ã‚¯ãƒªã‚¢');
        }
        
        function viewEvaluationHistory() {
            console.log('è©•ä¾¡å±¥æ­´ã‚’è¡¨ç¤º');
        }
        
        function openAbout() {
            window.open('/about', '_blank');
        }
        
        function openKeyboardShortcuts() {
            window.open('/help#shortcuts', '_blank');
        }
        
        // ãƒ˜ãƒ«ãƒ—æ©Ÿèƒ½
        function openHelp() {
            window.open('/help', '_blank');
        }
        
        // å±¥æ­´ãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯æ©Ÿèƒ½
        function openEvaluationHistory() {
            const structureId = getCurrentStructureId();
            if (structureId) {
                window.open(`/unified/structure/${structureId}/evaluation_history`, '_blank');
            } else {
                console.log('æ§‹é€ IDãŒå–å¾—ã§ãã¾ã›ã‚“');
            }
        }
        
        function openCompletionHistory() {
            const structureId = getCurrentStructureId();
            if (structureId) {
                window.open(`/unified/structure/${structureId}/completion_history`, '_blank');
            } else {
                console.log('æ§‹é€ IDãŒå–å¾—ã§ãã¾ã›ã‚“');
            }
        }
        
        function getCurrentStructureId() {
            // URLã‹ã‚‰æ§‹é€ IDã‚’å–å¾—
            const path = window.location.pathname;
            const match = path.match(/\/unified\/([^\/]+)/);
            return match ? match[1] : null;
        }
        
        // åˆæœŸåŒ–æ™‚ã«å±¥æ­´æ¬„ã‚’éè¡¨ç¤ºã«ã™ã‚‹
        document.addEventListener('DOMContentLoaded', function() {
            const historyPanel = document.querySelector('.history-panel');
            const evaluationPanel = document.querySelector('.evaluation-panel');
            
            if (historyPanel) {
                historyPanel.classList.add('collapsed');
                historyPanelVisible = false;
            }
            
            if (evaluationPanel) {
                evaluationPanel.classList.add('collapsed');
                evaluationPanelVisible = false;
            }
        });
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html> 