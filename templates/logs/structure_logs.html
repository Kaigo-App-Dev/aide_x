<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å±¥æ­´ä¸€è¦§ - {{ structure_id }}</title>
    <style>
        body { background: #1e1e1e; color: #ccc; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; }
        .container { max-width: 1200px; margin: 40px auto; background: #252526; border-radius: 8px; padding: 32px; }
        h1 { color: #4ec9b0; margin-bottom: 8px; }
        .meta { color: #888; font-size: 14px; margin-bottom: 24px; }
        .back-link { color: #4ec9b0; text-decoration: none; font-size: 14px; margin-bottom: 24px; display: inline-block; }
        .back-link:hover { text-decoration: underline; }
        .nav-tabs { display: flex; margin-bottom: 20px; border-bottom: 1px solid #3e3e42; }
        .nav-tab { background: none; border: none; color: #888; padding: 10px 20px; cursor: pointer; border-bottom: 2px solid transparent; text-decoration: none; }
        .nav-tab.active { color: #4ec9b0; border-bottom-color: #4ec9b0; }
        .nav-tab:hover { color: #ccc; }
        .filter-buttons { margin-bottom: 20px; }
        .filter-btn { background: #2d2d30; border: 1px solid #3e3e42; color: #ccc; padding: 8px 16px; margin-right: 10px; cursor: pointer; border-radius: 4px; }
        .filter-btn.active { background: #4ec9b0; color: white; border-color: #4ec9b0; }
        .filter-btn:hover { background: #3e3e42; }
        .history-section { margin-bottom: 30px; }
        .history-title { color: #4ec9b0; font-size: 18px; margin-bottom: 15px; border-bottom: 1px solid #3e3e42; padding-bottom: 8px; }
        .history-list { list-style: none; padding: 0; margin: 0; }
        .history-item { background: #2d2d30; border-radius: 6px; margin-bottom: 15px; padding: 20px; }
        .history-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        .history-meta { flex: 1; }
        .history-timestamp { color: #aaa; font-size: 13px; margin-bottom: 5px; }
        .history-type { color: #4ec9b0; font-size: 14px; font-weight: bold; }
        .history-actions { display: flex; gap: 10px; }
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; }
        .btn-apply { background: #4ec9b0; color: white; }
        .btn-apply:hover { background: #45b8a0; }
        .btn-diff { background: #2d2d30; color: #ccc; border: 1px solid #3e3e42; }
        .btn-diff:hover { background: #3e3e42; }
        .history-content { color: #ccc; line-height: 1.5; margin-bottom: 15px; }
        .diff-controls { background: #2d2d30; padding: 15px; border-radius: 6px; margin-bottom: 20px; }
        .diff-row { display: flex; gap: 15px; align-items: center; margin-bottom: 10px; }
        .diff-select { background: #1e1e1e; border: 1px solid #3e3e42; color: #ccc; padding: 8px 12px; border-radius: 4px; }
        .empty-state { text-align: center; padding: 60px 20px; color: #888; }
        .empty-state h3 { margin-bottom: 10px; color: #ccc; }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .history-timestamp {
            color: #4ec9b0;
            font-size: 12px;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .history-section {
            margin-bottom: 16px;
        }
        
        .history-section h4 {
            color: #ccc;
            font-size: 14px;
            margin: 0 0 8px 0;
            border-bottom: 1px solid #3e3e42;
            padding-bottom: 4px;
        }
        
        .eval-item, .comp-item {
            background: #2d2d30;
            padding: 8px;
            margin-bottom: 8px;
            border-radius: 4px;
            border-left: 3px solid #4ec9b0;
        }
        
        .eval-score {
            color: #4ec9b0;
            font-weight: bold;
            font-size: 12px;
            margin-bottom: 4px;
        }
        
        .eval-feedback {
            color: #ccc;
            font-size: 12px;
            line-height: 1.3;
        }
        
        .comp-content {
            color: #ccc;
            font-size: 11px;
            line-height: 1.3;
            margin: 0;
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        .no-diff, .no-content {
            color: #888;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }
        
        .error {
            color: #ff6b6b;
            text-align: center;
            padding: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>
<div class="container">
    <a href="/unified/{{ structure_id }}" class="btn btn-sm btn-secondary" style="margin-bottom: 16px; display: inline-block;">â† æ§‹æˆç”»é¢ã«æˆ»ã‚‹</a>
    <h1>ğŸ“Š å±¥æ­´ä¸€è¦§</h1>
    <div class="meta">
        <span>æ§‹æˆID: <b>{{ structure_id }}</b></span>
        {% if structure and structure.title %} | <span>ã‚¿ã‚¤ãƒˆãƒ«: <b>{{ structure.title }}</b></span>{% endif %}
    </div>
    
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ– -->
    <div class="nav-tabs">
        <a href="/logs/structure/{{ structure_id }}" class="nav-tab active">ğŸ“Š å…¨ä½“å±¥æ­´</a>
        <a href="/logs/structure/{{ structure_id }}/evaluations" class="nav-tab">ğŸ§  è©•ä¾¡å±¥æ­´</a>
        <a href="/logs/structure/{{ structure_id }}/completions" class="nav-tab">ğŸ” è£œå®Œå±¥æ­´</a>
    </div>
    
    <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³ -->
    <div class="filter-buttons">
        <button class="filter-btn active" onclick="filterHistory('all')">ğŸ“‹ ã™ã¹ã¦</button>
        <button class="filter-btn" onclick="filterHistory('evaluations')">ğŸ§  è©•ä¾¡ã®ã¿</button>
        <button class="filter-btn" onclick="filterHistory('completions')">ğŸ” è£œå®Œã®ã¿</button>
    </div>
    
    <!-- å·®åˆ†æ¯”è¼ƒã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
    <div class="diff-controls">
        <div class="diff-row">
            <span style="color: #888;">å·®åˆ†æ¯”è¼ƒ:</span>
            <select id="diffV1" class="diff-select">
                <option value="">ãƒãƒ¼ã‚¸ãƒ§ãƒ³1ã‚’é¸æŠ</option>
                {% for history in histories %}
                <option value="{{ history.timestamp }}">{{ history.timestamp[:19].replace('T', ' ') }}</option>
                {% endfor %}
            </select>
            <span style="color: #888;">vs</span>
            <select id="diffV2" class="diff-select">
                <option value="">ãƒãƒ¼ã‚¸ãƒ§ãƒ³2ã‚’é¸æŠ</option>
                {% for history in histories %}
                <option value="{{ history.timestamp }}">{{ history.timestamp[:19].replace('T', ' ') }}</option>
                {% endfor %}
            </select>
            <button onclick="compareDiff()" class="btn btn-diff">ğŸ” å·®åˆ†è¡¨ç¤º</button>
        </div>
    </div>
    
    <!-- å±¥æ­´å·®åˆ†è¡¨ç¤ºãƒ‘ãƒãƒ« -->
    <div class="diff-panel" style="margin: 24px 0; padding: 16px; background: #232323; border-radius: 6px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <button class="btn btn-outline btn-sm" data-history-index="prev" disabled>â—€ å‰ã®å±¥æ­´ã¸</button>
            <div class="diff-info" style="font-size: 13px; color: #aaa; text-align: center;">
                å±¥æ­´å·®åˆ†è¡¨ç¤º
            </div>
            <button class="btn btn-outline btn-sm" data-history-index="next" disabled>æ¬¡ã®å±¥æ­´ã¸ â–¶</button>
        </div>
        
        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
        <div class="diff-loading" style="display: none; text-align: center; padding: 20px;">
            <div class="loading-spinner" style="width: 20px; height: 20px; border: 2px solid #3e3e42; border-top: 2px solid #4ec9b0; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 10px;"></div>
            <p style="color: #888; margin: 0;">å±¥æ­´ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>
        
        <div style="display: flex; gap: 16px;">
            <div style="flex:1;">
                <div style="font-size: 12px; color: #888; margin-bottom: 8px;">å‰ã®å±¥æ­´</div>
                <div id="previousContent" style="background:#252526; padding:12px; border-radius:4px; min-height:120px; font-size:13px; line-height:1.4;"></div>
            </div>
            <div style="flex:1;">
                <div style="font-size: 12px; color: #888; margin-bottom: 8px;">ç¾åœ¨ã®å±¥æ­´</div>
                <div id="currentContent" style="background:#252526; padding:12px; border-radius:4px; min-height:120px; font-size:13px; line-height:1.4;"></div>
            </div>
        </div>
    </div>
    
    {% if histories %}
    <!-- è©•ä¾¡å±¥æ­´ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="history-section" id="evaluations-section">
        <div class="history-title">ğŸ§  è©•ä¾¡å±¥æ­´</div>
        <ul class="history-list">
            {% for history in histories %}
            {% if history.evaluations %}
            {% for eval in history.evaluations %}
            <li class="history-item evaluation-item" data-type="evaluation" data-timestamp="{{ history.timestamp }}">
                <div class="history-header">
                    <div class="history-meta">
                        <div class="history-timestamp">{{ history.timestamp[:19].replace('T', ' ') }}</div>
                        <div class="history-type">è©•ä¾¡ - ã‚¹ã‚³ã‚¢: {{ "%.1f"|format(eval.score * 100) if eval.score else "N/A" }}</div>
                    </div>
                    <div class="history-actions">
                        <button class="btn btn-apply" onclick="applyHistory('{{ structure_id }}', '{{ history.timestamp }}')">
                            âœ… å†é©ç”¨
                        </button>
                        <a href="/unified/{{ structure_id }}?restore={{ loop.index0 }}" class="btn btn-outline" style="text-decoration: none;">
                            ğŸ“ ã“ã®æ§‹æˆã‚’é–‹ã
                        </a>
                    </div>
                </div>
                <div class="history-content">
                    {{ eval.feedback[:100] + "..." if eval.feedback and eval.feedback|length > 100 else eval.feedback or "ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãªã—" }}
                </div>
            </li>
            {% endfor %}
            {% endif %}
            {% endfor %}
        </ul>
    </div>
    
    <!-- è£œå®Œå±¥æ­´ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="history-section" id="completions-section">
        <div class="history-title">ğŸ” è£œå®Œå±¥æ­´</div>
        <ul class="history-list">
            {% for history in histories %}
            {% if history.completions %}
            <div class="completion-history">
                <h4>âœ¨ è£œå®Œå±¥æ­´</h4>
                {% for completion in history.completions %}
                <div class="completion-item {% if completion.status == 'error' %}error{% endif %}">
                    <div class="completion-header">
                        <span class="provider">{{ completion.provider }}</span>
                        <span class="timestamp">{{ completion.timestamp }}</span>
                        {% if completion.status == 'error' %}
                        <span class="error-badge" style="background: #ff6b6b; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">æ§‹æ–‡ã‚¨ãƒ©ãƒ¼</span>
                        <button class="btn btn-repair" onclick="triggerClaudeRepair('{{ structure_id }}', '{{ completion.timestamp }}')" style="background: #4ec9b0; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px; border: none; cursor: pointer; margin-left: 8px;">
                            ğŸ”§ Claudeã§ä¿®å¾©
                        </button>
                        {% endif %}
                        {% if completion.fallback %}
                        <span class="repair-badge" style="background: #4ec9b0; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">Claudeä¿®å¾©æ¸ˆ</span>
                        {% endif %}
                    </div>
                    <div class="completion-content">
                        {% if completion.status == 'error' %}
                        <div class="error-content" style="background: #fff5f5; border-left: 4px solid #ff6b6b; padding: 8px; margin: 8px 0;">
                            <strong>ã‚¨ãƒ©ãƒ¼å†…å®¹:</strong> {{ completion.error_message }}<br>
                            {% if completion.error_log_path %}
                            <a href="{{ completion.error_log_path }}" target="_blank" style="color: #ff6b6b; text-decoration: underline;">ğŸ“„ ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª</a>
                            {% endif %}
                        </div>
                        {% endif %}
                        
                        <!-- Geminiå…ƒå‡ºåŠ› -->
                        <div class="gemini-original" style="margin-bottom: 12px;">
                            <h5 style="color: #888; margin: 0 0 8px 0; font-size: 13px;">ğŸ”¸ Geminiå…ƒå‡ºåŠ›:</h5>
                            <pre style="background: #1e1e1e; padding: 8px; border-radius: 4px; font-size: 11px; overflow-x: auto;">{{ completion.content }}</pre>
                        </div>
                        
                        <!-- Claudeä¿®å¾©çµæœ -->
                        {% if completion.fallback %}
                        <div class="claude-repair" style="margin-top: 16px; border-top: 1px solid #3e3e42; padding-top: 16px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <h5 style="color: #4ec9b0; margin: 0; font-size: 13px;">ğŸ”§ Claudeä¿®å¾©çµæœ:</h5>
                                <button class="btn btn-sm" onclick="toggleDiff('{{ loop.index0 }}')" style="background: #2d2d30; color: #ccc; border: 1px solid #3e3e42; padding: 4px 8px; font-size: 11px;">
                                    ğŸ“Š å·®åˆ†è¡¨ç¤º
                                </button>
                            </div>
                            
                            <!-- ä¿®å¾©çµæœã®è©³ç´° -->
                            <div class="repair-details" style="background: #1a1a1a; padding: 12px; border-radius: 6px; border-left: 4px solid #4ec9b0;">
                                <div style="margin-bottom: 8px;">
                                    <span style="color: #888; font-size: 12px;">ä¿®å¾©æ–¹æ³•:</span>
                                    <span style="color: #4ec9b0; font-size: 12px; margin-left: 8px;">{{ completion.fallback.repair_method }}</span>
                                </div>
                                <div style="margin-bottom: 8px;">
                                    <span style="color: #888; font-size: 12px;">ä¿®å¾©æ™‚åˆ»:</span>
                                    <span style="color: #ccc; font-size: 12px; margin-left: 8px;">{{ completion.fallback.timestamp[:19].replace('T', ' ') }}</span>
                                </div>
                                <div>
                                    <span style="color: #888; font-size: 12px;">ä¿®å¾©çµæœ:</span>
                                    <pre style="background: #252526; padding: 8px; border-radius: 4px; font-size: 11px; overflow-x: auto; margin: 8px 0 0 0;">{{ completion.fallback.content }}</pre>
                                </div>
                            </div>
                            
                            <!-- å·®åˆ†è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                            <div id="diff-{{ loop.index0 }}" class="diff-area" style="display: none; margin-top: 12px; background: #1a1a1a; padding: 12px; border-radius: 6px;">
                                <div style="display: flex; gap: 12px;">
                                    <div style="flex: 1;">
                                        <div style="font-size: 11px; color: #888; margin-bottom: 6px;">âŒ Geminiå…ƒå‡ºåŠ›</div>
                                        <div class="before-content" style="background: #252526; padding: 8px; border-radius: 4px; font-size: 10px; line-height: 1.3; max-height: 200px; overflow-y: auto; border-left: 3px solid #ff6b6b;">
                                            {{ completion.content }}
                                        </div>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-size: 11px; color: #888; margin-bottom: 6px;">âœ… Claudeä¿®å¾©å¾Œ</div>
                                        <div class="after-content" style="background: #252526; padding: 8px; border-radius: 4px; font-size: 10px; line-height: 1.3; max-height: 200px; overflow-y: auto; border-left: 3px solid #4ec9b0;">
                                            {{ completion.fallback.content }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% endfor %}
        </ul>
    </div>
    {% else %}
    <div class="empty-state">
        <h3>ğŸ“­ å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</h3>
        <p>ã“ã®æ§‹æˆã®å±¥æ­´ã¯ã¾ã ä¿å­˜ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
        <p>çµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§è©•ä¾¡ã‚’å®Ÿè¡Œã—ã¦ã‹ã‚‰ã€å±¥æ­´ã‚’ä¿å­˜ã—ã¦ãã ã•ã„ã€‚</p>
    </div>
    {% endif %}
</div>

<script src="{{ url_for('static', filename='js/history_diff.js') }}"></script>
<script>
// ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½
function filterHistory(type) {
    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    const evaluationItems = document.querySelectorAll('.evaluation-item');
    const completionItems = document.querySelectorAll('.completion-item');
    
    switch (type) {
        case 'evaluations':
            evaluationItems.forEach(item => item.style.display = 'block');
            completionItems.forEach(item => item.style.display = 'none');
            break;
        case 'completions':
            evaluationItems.forEach(item => item.style.display = 'none');
            completionItems.forEach(item => item.style.display = 'block');
            break;
        default: // 'all'
            evaluationItems.forEach(item => item.style.display = 'block');
            completionItems.forEach(item => item.style.display = 'block');
            break;
    }
}

// å±¥æ­´å†é©ç”¨
function applyHistory(structureId, timestamp) {
    if (confirm('ã“ã®å±¥æ­´ã‚’å†é©ç”¨ã—ã¾ã™ã‹ï¼Ÿ')) {
        fetch(`/logs/apply/${structureId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ timestamp: timestamp })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.href = `/unified/${structureId}`;
            } else {
                alert('å†é©ç”¨ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + data.error);
            }
        })
        .catch(error => {
            console.error('å†é©ç”¨ã‚¨ãƒ©ãƒ¼:', error);
            alert('å†é©ç”¨ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
        });
    }
}

// å·®åˆ†æ¯”è¼ƒ
function compareDiff() {
    const v1 = document.getElementById('diffV1').value;
    const v2 = document.getElementById('diffV2').value;
    
    if (!v1 || !v2) {
        alert('æ¯”è¼ƒã™ã‚‹2ã¤ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
    }
    
    if (v1 === v2) {
        alert('ç•°ãªã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
    }
    
    window.location.href = `/logs/diff/{{ structure_id }}?v1=${v1}&v2=${v2}`;
}

// Claudeä¿®å¾©çµæœã®å·®åˆ†è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
function toggleDiff(index) {
    const diffArea = document.getElementById(`diff-${index}`);
    if (diffArea.style.display === 'none') {
        diffArea.style.display = 'block';
    } else {
        diffArea.style.display = 'none';
    }
}

// Claudeä¿®å¾©ãƒˆãƒªã‚¬ãƒ¼
function triggerClaudeRepair(structureId, timestamp) {
    if (!confirm('Claudeã«ã‚ˆã‚‹æ§‹æ–‡ä¿®å¾©ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ\n\nä¿®å¾©çµæœã¯æ–°ã—ã„æ§‹æˆã¨ã—ã¦ä¿å­˜ã•ã‚Œã¾ã™ã€‚')) {
        return;
    }
    
    // ä¿®å¾©ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
    const repairBtn = event.target;
    const originalText = repairBtn.textContent;
    repairBtn.disabled = true;
    repairBtn.textContent = 'ğŸ”§ ä¿®å¾©ä¸­...';
    repairBtn.style.opacity = '0.6';
    
    // ä¿®å¾©APIã‚’å‘¼ã³å‡ºã—
    fetch(`/unified/repair_structure/${structureId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            timestamp: timestamp,
            structure_id: structureId
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // ä¿®å¾©æˆåŠŸ
            showNotification('âœ… Claudeã«ã‚ˆã‚‹ä¿®å¾©ã‚’é©ç”¨ã—ã¾ã—ãŸ', 'success');
            
            // ä¿®å¾©çµæœã‚’è¡¨ç¤º
            if (data.repaired_content) {
                showRepairResult(data.repaired_content, data.original_content);
            }
            
            // ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦æœ€æ–°çŠ¶æ…‹ã‚’è¡¨ç¤º
            setTimeout(() => {
                window.location.reload();
            }, 2000);
        } else {
            // ä¿®å¾©å¤±æ•—
            showNotification('âŒ ä¿®å¾©ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (data.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'), 'error');
            
            if (data.claude_output) {
                showClaudeOutput(data.claude_output);
            }
        }
    })
    .catch(error => {
        console.error('ä¿®å¾©ã‚¨ãƒ©ãƒ¼:', error);
        showNotification('âŒ ä¿®å¾©ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
    })
    .finally(() => {
        // ãƒœã‚¿ãƒ³ã‚’å¾©å…ƒ
        repairBtn.disabled = false;
        repairBtn.textContent = originalText;
        repairBtn.style.opacity = '1';
    });
}

// é€šçŸ¥è¡¨ç¤º
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 16px;
        border-radius: 6px;
        color: white;
        font-weight: bold;
        z-index: 1000;
        max-width: 300px;
        word-wrap: break-word;
    `;
    
    if (type === 'success') {
        notification.style.background = '#4ec9b0';
    } else if (type === 'error') {
        notification.style.background = '#ff6b6b';
    } else {
        notification.style.background = '#007acc';
    }
    
    notification.textContent = message;
    document.body.appendChild(notification);
    
    // 3ç§’å¾Œã«è‡ªå‹•å‰Šé™¤
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 3000);
}

// ä¿®å¾©çµæœè¡¨ç¤º
function showRepairResult(repairedContent, originalContent) {
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1001;
        display: flex;
        justify-content: center;
        align-items: center;
    `;
    
    modal.innerHTML = `
        <div style="background: #252526; border-radius: 8px; padding: 20px; max-width: 80%; max-height: 80%; overflow: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="color: #4ec9b0; margin: 0;">ğŸ”§ Claudeä¿®å¾©çµæœ</h3>
                <button onclick="this.closest('.modal').remove()" style="background: none; border: none; color: #ccc; font-size: 20px; cursor: pointer;">Ã—</button>
            </div>
            <div style="display: flex; gap: 16px;">
                <div style="flex: 1;">
                    <h4 style="color: #ff6b6b; margin: 0 0 8px 0;">âŒ ä¿®å¾©å‰</h4>
                    <pre style="background: #1e1e1e; padding: 12px; border-radius: 4px; font-size: 12px; overflow-x: auto; max-height: 300px;">${JSON.stringify(originalContent, null, 2)}</pre>
                </div>
                <div style="flex: 1;">
                    <h4 style="color: #4ec9b0; margin: 0 0 8px 0;">âœ… ä¿®å¾©å¾Œ</h4>
                    <pre style="background: #1e1e1e; padding: 12px; border-radius: 4px; font-size: 12px; overflow-x: auto; max-height: 300px;">${JSON.stringify(repairedContent, null, 2)}</pre>
                </div>
            </div>
        </div>
    `;
    
    modal.className = 'modal';
    document.body.appendChild(modal);
}

// Claudeå‡ºåŠ›è¡¨ç¤º
function showClaudeOutput(claudeOutput) {
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1001;
        display: flex;
        justify-content: center;
        align-items: center;
    `;
    
    modal.innerHTML = `
        <div style="background: #252526; border-radius: 8px; padding: 20px; max-width: 80%; max-height: 80%; overflow: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="color: #ff9800; margin: 0;">âš ï¸ Claudeå‡ºåŠ›</h3>
                <button onclick="this.closest('.modal').remove()" style="background: none; border: none; color: #ccc; font-size: 20px; cursor: pointer;">Ã—</button>
            </div>
            <div style="color: #ccc; margin-bottom: 12px;">
                Claudeã®å‡ºåŠ›ã‚’ç¢ºèªã—ã€æ‰‹å‹•ä¿®æ­£ãŒå¿…è¦ã§ã™ã€‚
            </div>
            <pre style="background: #1e1e1e; padding: 12px; border-radius: 4px; font-size: 12px; overflow-x: auto; max-height: 400px;">${claudeOutput}</pre>
        </div>
    `;
    
    modal.className = 'modal';
    document.body.appendChild(modal);
}
</script>
</body>
</html> 