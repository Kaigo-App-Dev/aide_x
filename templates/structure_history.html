{% extends "base.html" %}

{% block content %}
<h2>ğŸ•˜ æ§‹æˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå±¥æ­´ä¸€è¦§</h2>

<form method="get" class="mb-3">
  <input type="text" name="keyword" placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã¾ãŸã¯IDã§æ¤œç´¢" value="{{ keyword }}">

  <label>é–‹å§‹æ—¥:
    <input type="date" name="start_date" value="{{ start_date }}">
  </label>
  <label>çµ‚äº†æ—¥:
    <input type="date" name="end_date" value="{{ end_date }}">
  </label>

  <label>ç¢ºå®šçŠ¶æ…‹:
    <select name="is_final">
      <option value="" {% if not is_final_filter %}selected{% endif %}>ã™ã¹ã¦</option>
      <option value="true" {% if is_final_filter == 'true' %}selected{% endif %}>ç¢ºå®šæ¸ˆã¿</option>
      <option value="false" {% if is_final_filter == 'false' %}selected{% endif %}>æœªç¢ºå®š</option>
    </select>
  </label>

  <button type="submit">çµã‚Šè¾¼ã¿</button>
</form>

<table border="1" cellpadding="5" cellspacing="0" style="width:100%;">
  <thead>
    <tr>
      <th><a href="?sort=id&order={{ 'asc' if sort_key!='id' or order=='desc' else 'desc' }}">ID</a></th>
      <th><a href="?sort=title&order={{ 'asc' if sort_key!='title' or order=='desc' else 'desc' }}">ã‚¿ã‚¤ãƒˆãƒ«</a></th>
      <th><a href="?sort=intent_match&order={{ 'asc' if sort_key!='intent_match' or order=='desc' else 'desc' }}">Intent Match</a></th>
      <th><a href="?sort=updated_at&order={{ 'asc' if sort_key!='updated_at' or order=='desc' else 'desc' }}">æ›´æ–°æ—¥æ™‚</a></th>
      <th>æ“ä½œ</th>
    </tr>
  </thead>
  <tbody>
    {% for s in structures %}
    <tr>
      <td>{{ s.id }}</td>
      <td>{{ s.title }}</td>
      <td>
        {{ "%.2f"|format(s.intent_match or 0) }}<br>
        <progress value="{{ s.intent_match or 0 }}" max="100" style="width: 80px;"></progress>
      </td>
      <td>{{ s.updated_at }}</td>
      <td>
        <a href="{{ url_for('structure.edit_structure', structure_id=s.id) }}">ç·¨é›†</a>
        <form method="post"
              action="{{ url_for('structure.delete_structure', structure_id=s.id) }}"
              style="display:inline;"
              onsubmit="return confirm('æœ¬å½“ã«ã“ã®å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
          <button type="submit" class="btn btn-danger">ğŸ”š å‰Šé™¤</button>
        </form>
      </td>
    </tr>
    {% else %}
    <tr><td colspan="5">âš  è©²å½“ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
